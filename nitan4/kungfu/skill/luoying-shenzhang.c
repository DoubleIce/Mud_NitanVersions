inherit SKILL;
//by dream

mapping *action = ({
([      "action" : "$NÓÒÊÖÎåÖ¸»º»ºÒ»ÊÕ£¬Ò»Ê½¡¸»Ø·ç·÷Áø¡¹£¬ÎåÖ¸ºöÈ»·÷Ïò$nÎå´¦´óÑ¨",
        "force"  : 80,
        "attack" : 14,
        "dodge"  : 7,
        "parry"  : 8,
        "damage" : 5,
        "lvl"    : 0,
        "damage_type" : "ÄÚÉË",
        "skill_name"  : "»Ø·ç·÷Áø"
]),
([      "action" : "$N¶¸È»Ò»¸öÇáÇÉ×ªÉí£¬µ¥ÕÆÅüÂä£¬Ò»Ê½¡¸½­³Ç·É»¨¡¹£¬ÅÄÏò$nµÄÍ·¶¥",
        "force"  : 91,
        "attack" : 17,
        "dodge"  : 10,
        "parry"  : 13,
        "damage" : 9,
        "lvl"    : 20,
        "damage_type" : "ðöÉË",
        "skill_name"  : "½­³Ç·É»¨"
]),
([      "action" : "$NÍ»È»Ô¾Æð£¬Ë«ÊÖÁ¬»·£¬ÔËÕÆÈç½££¬Ò»Ê½¡¸Óê¼±·ç¿ñ¡¹£¬¹¥Ïò$nµÄÈ«Éí",
        "force"  : 108,
        "attack" : 22,
        "dodge"  : 17,
        "parry"  : 15,
        "damage" : 12,
        "lvl"    : 40,
        "damage_type" : "ðöÉË",
        "skill_name"  : "Óê¼±·ç¿ñ"
]),
([      "action" : "$NÍ»È»³éÉí¶øÍË£¬Ò»Ê½¡¸Á÷»ª·×·É¡¹£¬Æ½Éí·ÉÆð£¬Ë«ÕÆÏò$nÁ¬ÅÄÊýÕÆ",
        "force"  : 180,
        "attack" : 33,
        "dodge"  : 13,
        "parry"  : 16,
        "damage" : 28,
        "lvl"    : 60,
        "damage_type" : "ðöÉË",
        "skill_name"  : "Á÷»ª·×·É"
]),
([      "action" : "$NÍ»È»³éÉíÔ¾Æð£¬ÓÒÕÆ·­¹ö£¬Ò»Ê½¡¸²ÊÔÆ×·ÔÂ¡¹ÇÀÔÚ×óÕÆÇ°Ïò$nµÄ$lÅÄÈ¥",
        "force"  : 210,
        "attack" : 38,
        "dodge"  : 30,
        "parry"  : 25,
        "damage" : 33,
        "lvl"    : 80,
        "damage_type" : "ðöÉË",
        "skill_name"  : "²ÊÔÆ×·ÔÂ"
]),
([      "action" : "$NÊ¹Ò»Ê½¡¸°×ºç¾­Ìì¡¹£¬Ë«ÕÆÎè³öÎÞÊýÈ¦¾¢Æø£¬Ò»»·»·Ïò$nµÄ$lí½È¥",
        "force"  : 310,
        "attack" : 72,
        "dodge"  : 41,
        "parry"  : 55,
        "damage" : 68,
        "lvl"    : 100,
        "damage_type" : "ÄÚÉË",
        "skill_name"  : "°×ºç¾­Ìì"
]),
([      "action" : "$NÒ»Ê½¡¸ÂäÓ¢ÂþÌì¡¹£¬Ë«ÕÆÔÚÉíÇ°¼²×ª£¬ÕÆ»¨·ÉÎè£¬ÆÌÌì¸ÇµØÖ±Ö¸Ïò$n",
        "force"  : 378,
        "attack" : 84,
        "dodge"  : 41,
        "parry"  : 65,
        "damage" : 103,
        "lvl"    : 120,
        "damage_type" : "ðöÉË",
        "skill_name"  : "ÂäÓ¢ÂþÌì"
]),
//ÐÂÔöÈýÕÐ
([      "action" : "[1;32m$NÒ»Ê½¡¸Áø¼ªÏé¡¹£¬Ë«ÕÆÈçÁøÐõ°ãÔÚÐØÇ°°Ú¶¯£¬¶ÙÊ±Ò»µÀµÀ°µ¾¢¿ìËÙ³åÏò$n[2;37;0m",
        "force"  : 400,
        "attack" : 200,
        "dodge"  : 200,
        "parry"  : 200,
        "damage" : 250,
        "lvl"    : 300,
        "damage_type" : "ÄÚÉË",
        "skill_name"  : "[1;32mÁø¼ªÏé[2;37;0m"
]),
([      "action" : "[1;37m$NµÄÂäÓ¢ÉñÕÆÒÑÐÞÁ¶ÖÁ´ó³É£¬Ò»ÕÐ¡¸»¡ÔÂÕ¶¡¹£¬ÃÍÈ»Áè¿Õ·ÉÆð£¬µ±Í·Ïò$nÕ¶È¥[2;37;0m",
        "force"  : 500,
        "attack" : 300,
        "dodge"  : 300,
        "parry"  : 300,
        "damage" : 350,
        "lvl"    : 350,
        "damage_type" : "ÄÚÉË",
        "skill_name"  : "[1;37m»¡ÔÂÕ¶[2;37;0m"
]),
([      "action" : "[1;36m$NµÄÂäÓ¢ÉñÕÆÒÑÈë·µè±¹éÕæ¾³½ç£¬ÔËÆðÈ«ÉíÄÚÁ¦£¬Ò»ÕÐ¡¸±ÌÌÎËÌ¡¹£¬Èçº£ÀË°ãµÄ
                                                                                               
ÄÚÁ¦Ïò$nÓ¿È¥£¬¶ÙÊ±ÈýÕÉ·¶Î§ÄÚÉ³Ê¯·ÉÐý£¬ÑÛ¼û$nÒÑÎÞ´¦¿ÉÌÓ[2;37;0m",
        "force"  : 850,
        "attack" : 500,
        "dodge"  : 500,
        "parry"  : 500,
        "damage" : 750,
        "lvl"    : 400,
        "damage_type" : "ÄÚÉË",
        "skill_name"  : "[1;36m±ÌÌÎËÌ[2;37;0m"
])
});

int valid_enable(string usage)
{
        return usage == "strike" || usage == "parry";
}

int valid_combine(string combo)
{
        return combo == "xuanfeng-tui";
}

int valid_learn(object me)
{
        if (me->query_temp("weapon") || me->query_temp("secondary_weapon"))
                return notify_fail("Á·ÂäÓ¢Éñ½£ÕÆ±ØÐë¿ÕÊÖ¡£\n");

        if ((int)me->query_skill("force") < 200)
                return notify_fail("ÄãµÄ»ù±¾ÄÚ¹¦»ðºò²»¹»£¬ÎÞ·¨Ñ§ÂäÓ¢Éñ½£ÕÆ¡£\n");

        if ((int)me->query("max_neili") < 2000)
                return notify_fail("ÄãµÄÄÚÁ¦Ì«Èõ£¬ÎÞ·¨Á·ÂäÓ¢Éñ½£ÕÆ¡£\n");

        if ((int)me->query_skill("strike", 1) < (int)me->query_skill("luoying-shenzhang", 1))
                return notify_fail("ÄãµÄ»ù±¾ÕÆ·¨Ë®Æ½ÓÐÏÞ£¬ÎÞ·¨Áì»á¸ü¸ßÉîµÄÂäÓ¢Éñ½£ÕÆ¡£\n");

        /*
        if (me->query("character") == "ÒõÏÕ¼éÕ©")
                return notify_fail("Ñ§Ï°ÂäÓ¢Éñ½£ÕÆÐèÒª²©´óµÄÐØ»³£¬Ã»ÓÐ´ËµÈÐØ»³ÊÇÎÞ·¨ÁìÎòµÄ¡£\n");
        */

        if (me->query("str") < 22)
                return notify_fail("ÄãÏÈÌì±ÛÁ¦²»×ã£¬ÎÞ·¨ÐÞÁ¶ÂäÓ¢Éñ½£ÕÆ¡£\n");

        if ((int)me->query_skill("strike", 1) < 200)
                return notify_fail("ÄãµÄ»ù±¾ÕÆ·¨²»¹»æµÊì£¬ÎÞ·¨ÐÞÁ¶ÂäÓ¢Éñ½£ÕÆ¡£\n");

        if ((int)me->query_skill("strike", 1) < 200)
                return notify_fail("ÄãµÄ»ù±¾ÕÆ·¨²»¹»æµÊì£¬ÎÞ·¨ÐÞÁ¶ÂäÓ¢Éñ½£ÕÆ¡£\n");

        return 1;
}

string query_skill_name(int level)
{
        int i;
        for (i = sizeof(action)-1; i >= 0; i--)
                if (level >= action[i]["lvl"])
                        return action[i]["skill_name"];
}

mapping query_action(object me, object weapon)
{
        int i, level;
        level = (int)me->query_skill("luoying-shenzhang", 1);
        for (i = sizeof(action); i > 0; i--)
                if (level > action[i-1]["lvl"])
                        return action[NewRandom(i, 20, level/5)];
}

int practice_skill(object me)
{
        if ((int)me->query("qi") < 300)
                return notify_fail("ÄãµÄÌåÁ¦Ì«µÍÁË¡£\n");

        if ((int)me->query("neili") < 100)
                return notify_fail("ÄãµÄÄÚÁ¦²»¹»Á·ÂäÓ¢Éñ½£ÕÆ¡£\n");

        me->receive_damage("qi", 45);
        me->add("neili", -40);
        return 1;
}

string perform_action_file(string action)
{
        return __DIR__"luoying-shenzhang/" + action;
}

